# 一、编写脚本
```bash
cat >1.sh<<\EOF
#!/bin/bash
infs=(`ls /sys/class/net`)
>/tmp/speed.txt
>/tmp/network.txt
for i in ${infs[*]};
do  
    get_Speed=`ethtool ${i} 2>/dev/null|grep Speed`
    echo $i ${get_Speed}>>/tmp/speed.txt
done
#获取万兆网卡名称
networks=`cat /tmp/speed.txt|grep "10000Mb/s"|awk '{print $1}'`

#获取cpu核数
cpu_num=`cat /proc/cpuinfo| grep "processor"| wc -l`

#获取网卡当前配置
for net in ${networks};
do
    pre_set=`ethtool -l ${net}|grep Combined|sed -n '1p'|awk '{print $2}'`
    cur_set=`ethtool -l ${net}|grep Combined|sed -n '2p'|awk '{print $2}'`
    #网卡最大支持的队列大于CPU核数，并且当前队列小于网卡最大支持的队列
    if [ $pre_set -gt $cpu_num ] && [ $cur_set -lt $pre_set ];then
        echo "设置 $net 网卡队列为CPU核数:  $cpu_num"
        ethtool -L $net combined $cpu_num >/dev/null 2>&1
    else [ $pre_set -lt $cpu_num ] && [ $cur_set -lt $pre_set ]
        echo "设置 $net 网卡队列为支持的最大队列数:  $pre_set"
        ethtool -L $net combined $pre_set >/dev/null 2>&1
    fi
done
EOF
sh 1.sh
```

# 二、运行结果
```
[root@root ~]# sh 1.sh
设置 eth2 网卡队列为CPU核数:  24
设置 eth3 网卡队列为支持的最大队列数:  4
```
